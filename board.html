<!doctype html>
<html>
 <head>
 <meta charset="euc-kr">
    <title>게시판</title>
    <link rel="stylesheet" href="common/style.css"> <!-- 공통스타일! -->
</head>
<body class="commbody">
<!--header-->
	<div class="header">
		<div>
			<h1 class="intro-header">Board</h1>
			<p class="intro-subtitle">문의사항이 있으면 글을 남겨주세요.</p>
		</div>

		<div class="intro-controls">
			<button class="photo-btn photo-btn-secondary" onclick="openWriteModal()">
			<img src="images/bear/bear (55).png" class="menu-img">글쓰기
			</button>
		</div>
	</div>
	
<!--본문-->
    <div class="board-container">
        <div class="board-list" id="boardList">
            <!-- 게시글 목록 -->
        </div>
    </div>

    <!-- 글쓰기/수정 모달 -->
    <div class="modal-overlay" id="writeModal">
        <div class="modal-box">
            <div class="modal-title" id="writeModalTitle">글쓰기</div>
            
            <label class="modal-label">제목</label>
            <input type="text" class="modal-input" id="postTitle" placeholder="제목을 입력하세요">
            
            <label class="modal-label">작성자</label>
            <input type="text" class="modal-input" id="postAuthor" placeholder="작성자 이름을 입력하세요">
            
            <label class="modal-label">내용</label>
            <textarea class="modal-textarea" id="postContent" placeholder="내용을 입력하세요"></textarea>
            
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-secondary" onclick="closeWriteModal()">취소</button>
                <button class="modal-btn modal-btn-primary" onclick="savePost()">저장</button>
            </div>
        </div>
    </div>

    <!-- 글 상세보기 모달 -->
    <div class="modal-overlay" id="viewModal">
        <div class="modal-box">
            <div class="post-detail">
                <div class="post-detail-title" id="viewTitle"></div>
                <div class="post-detail-meta" id="viewMeta"></div>
                <div class="post-detail-content" id="viewContent"></div>
            </div>
            
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-secondary" onclick="closeViewModal()">닫기</button>
                <button class="modal-btn modal-btn-primary" onclick="editPostFromView()">수정</button>
            </div>
        </div>
    </div>

    <script>
        let posts = [];
        let editingPostId = null;
        let currentViewingPostId = null;

        // 로컬 스토리지에서 게시글 불러오기
        function loadPosts() {
            const savedPosts = localStorage.getItem('boardPosts');
            if (savedPosts) {
                posts = JSON.parse(savedPosts);
            }
            renderPosts();
        }

        // 로컬 스토리지에 게시글 저장
        function savePosts() {
            localStorage.setItem('boardPosts', JSON.stringify(posts));
        }

        // 게시글 목록 렌더링
        function renderPosts() {
            const boardList = document.getElementById('boardList');
            
            if (posts.length === 0) {
                boardList.innerHTML = `
                    <div class="empty-board">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                            <polyline points="10 9 9 9 8 9"/>
                        </svg>
                        <h3>게시글이 없습니다</h3>
                        <p>첫 번째 글을 작성해보세요!</p>
                    </div>
                `;
                return;
            }

            boardList.innerHTML = '';
            
            // 최신글이 위로 오도록 역순 정렬
            const sortedPosts = [...posts].reverse();
            
            sortedPosts.forEach(post => {
                const item = document.createElement('div');
                item.className = 'board-item';
                
                const content = document.createElement('div');
                content.className = 'board-item-content';
                content.onclick = () => viewPost(post.id);
                content.innerHTML = `
                    <div class="board-item-title">${escapeHtml(post.title)}</div>
                    <div class="board-item-meta">${escapeHtml(post.author)} · ${post.date}</div>
                `;
                
                const buttons = document.createElement('div');
                buttons.className = 'board-item-buttons';
                buttons.innerHTML = `
                    <button class="edit-btn" onclick="editPost('${post.id}'); event.stopPropagation();">수정</button>
                    <button class="delete-btn" onclick="deletePost('${post.id}'); event.stopPropagation();">삭제</button>
                `;
                
                item.appendChild(content);
                item.appendChild(buttons);
                boardList.appendChild(item);
            });
        }

        // HTML 이스케이프 처리
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // 글쓰기 모달 열기
        function openWriteModal() {
            editingPostId = null;
            document.getElementById('writeModalTitle').textContent = '글쓰기';
            document.getElementById('postTitle').value = '';
            document.getElementById('postAuthor').value = '';
            document.getElementById('postContent').value = '';
            document.getElementById('writeModal').classList.add('active');
            document.getElementById('postTitle').focus();
        }

        // 글쓰기 모달 닫기
        function closeWriteModal() {
            document.getElementById('writeModal').classList.remove('active');
            editingPostId = null;
        }

        // 게시글 저장
        function savePost() {
            const title = document.getElementById('postTitle').value.trim();
            const author = document.getElementById('postAuthor').value.trim();
            const content = document.getElementById('postContent').value.trim();

            if (!title) {
                alert('제목을 입력하세요.');
                document.getElementById('postTitle').focus();
                return;
            }

            if (!author) {
                alert('작성자를 입력하세요.');
                document.getElementById('postAuthor').focus();
                return;
            }

            if (!content) {
                alert('내용을 입력하세요.');
                document.getElementById('postContent').focus();
                return;
            }

            const now = new Date();
            const dateString = `${now.getFullYear()}.${String(now.getMonth() + 1).padStart(2, '0')}.${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;

            if (editingPostId) {
                // 수정
                const post = posts.find(p => p.id === editingPostId);
                if (post) {
                    post.title = title;
                    post.author = author;
                    post.content = content;
                    post.date = dateString + ' (수정됨)';
                }
            } else {
                // 새 글 작성
                const newPost = {
                    id: Date.now().toString(),
                    title: title,
                    author: author,
                    content: content,
                    date: dateString
                };
                posts.push(newPost);
            }

            savePosts();
            renderPosts();
            closeWriteModal();
        }

        // 게시글 수정
        function editPost(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;

            editingPostId = postId;
            document.getElementById('writeModalTitle').textContent = '글 수정';
            document.getElementById('postTitle').value = post.title;
            document.getElementById('postAuthor').value = post.author;
            document.getElementById('postContent').value = post.content;
            document.getElementById('writeModal').classList.add('active');
            document.getElementById('postTitle').focus();
        }

        // 게시글 삭제
        function deletePost(postId) {
            if (!confirm('정말 삭제하시겠습니까?')) return;

            posts = posts.filter(p => p.id !== postId);
            savePosts();
            renderPosts();
        }

        // 게시글 상세보기
        function viewPost(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;

            currentViewingPostId = postId;
            document.getElementById('viewTitle').textContent = post.title;
            document.getElementById('viewMeta').textContent = `${post.author} · ${post.date}`;
            document.getElementById('viewContent').textContent = post.content;
            document.getElementById('viewModal').classList.add('active');
        }

        // 상세보기 모달 닫기
        function closeViewModal() {
            document.getElementById('viewModal').classList.remove('active');
            currentViewingPostId = null;
        }

        // 상세보기에서 수정 버튼 클릭
        function editPostFromView() {
            closeViewModal();
            editPost(currentViewingPostId);
        }

        // 모달 외부 클릭 시 닫기
        document.getElementById('writeModal').addEventListener('click', (e) => {
            if (e.target.id === 'writeModal') {
                closeWriteModal();
            }
        });

        document.getElementById('viewModal').addEventListener('click', (e) => {
            if (e.target.id === 'viewModal') {
                closeViewModal();
            }
        });

        // 페이지 로드 시 게시글 불러오기
        window.addEventListener('load', loadPosts);
    </script>
</body>
</html>
